<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸šà¹€à¸ªà¸µà¸¢à¸‡à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸‚à¸²à¸¢à¸›à¸£à¸°à¸à¸±à¸™</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2vK/lV8f7xW3m5M1Zc6p9z2w1yT4fF/r5m1v3i4f8O/1Z+6h+5v+2/4g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Tahoma', sans-serif;
Â  Â  Â  Â  Â  Â  background: #f0f2f5;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #004085;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .user-info {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .question {
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  border: 1px solid #e2e6ea;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  .question p {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #0056b3;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .control-buttons {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  button {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease, transform 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  button:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  }
Â  Â  Â  Â  button:active {
Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  }
Â  Â  Â  Â  button:disabled {
Â  Â  Â  Â  Â  Â  background-color: #e0e0e0 !important;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  transform: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .start-btn { background-color: #28a745; color: white; }
Â  Â  Â  Â  .stop-btn { background-color: #dc3545; color: white; }
Â  Â  Â  Â  .play-btn { background-color: #007bff; color: white; }
Â  Â  Â  Â  audio {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .submit-btn {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  .message-box {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  background-color: #d1e7dd;
Â  Â  Â  Â  Â  Â  color: #0f5132;
Â  Â  Â  Â  Â  Â  border: 1px solid #badbcc;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }
Â  Â  Â  Â  .loading-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.8);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 999;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .loading-spinner {
Â  Â  Â  Â  Â  Â  border: 4px solid #f3f3f3;
Â  Â  Â  Â  Â  Â  border-top: 4px solid #3498db;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin {
Â  Â  Â  Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .upload-progress {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 25px;
Â  Â  Â  Â  Â  Â  background-color: #e9ecef;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  .progress-bar {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  width: 0%;
Â  Â  Â  Â  Â  Â  transition: width 0.4s ease;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .file-size {
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="messageBox" class="message-box"></div>
Â  Â  <div id="loadingOverlay" class="loading-overlay">
Â  Â  Â  Â  <div class="loading-spinner"></div>
Â  Â  Â  Â  <p id="loadingText">à¸à¸³à¸¥à¸±à¸‡à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”... à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ</p>
Â  Â  Â  Â  <div class="upload-progress" style="width: 200px;">
Â  Â  Â  Â  Â  Â  <div class="progress-bar" id="progressBar"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ğŸ¤ à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸šà¹€à¸ªà¸µà¸¢à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸™à¸±à¸à¸‡à¸²à¸™à¸‚à¸²à¸¢à¸›à¸£à¸°à¸à¸±à¸™</h1>
Â  Â  Â  Â  <div class="user-info"><b>à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸—à¸³à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸š:</b> <span id="userNameDisplay">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</span></div>

Â  Â  Â  Â  <div id="questions"></div>

Â  Â  Â  Â  <button id="submitAllBtn" class="submit-btn">
Â  Â  Â  Â  Â  Â  <i class="fas fa-upload"></i> à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” & à¹„à¸›à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸­à¹„à¸›
Â  Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  // Import Firebase modules
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInWithCustomToken, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
Â  Â  Â  Â  import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // This function displays a custom message box instead of the browser's native alert().
Â  Â  Â  Â  function showMessage(text, type = 'info') {
Â  Â  Â  Â  Â  Â  const messageBox = document.getElementById('messageBox');
Â  Â  Â  Â  Â  Â  messageBox.textContent = text;
Â  Â  Â  Â  Â  Â  messageBox.style.display = 'block';
Â  Â  Â  Â  Â  Â  if (type === 'error') {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.backgroundColor = '#f8d7da';
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.color = '#721c24';
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.borderColor = '#f5c6cb';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.backgroundColor = '#d1e7dd';
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.color = '#0f5132';
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.borderColor = '#badbcc';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.display = 'none';
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Firebase configuration. This should be a valid configuration for your project.
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyA4OrZERUoxWPiShCEWVvz1MK9cYGO3_K8",
Â  Â  Â  Â  Â  Â  authDomain: "new-record-3ccd6.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "new-record-3ccd6",
Â  Â  Â  Â  Â  Â  storageBucket: "new-record-3ccd6.appspot.com",
Â  Â  Â  Â  Â  Â  messagingSenderId: "1065863160189",
Â  Â  Â  Â  Â  Â  appId: "1:1065863160189:web:25313e55b0733f5e126c14",
Â  Â  Â  Â  Â  Â  measurementId: "G-JW6N2HYR58"
Â  Â  Â  Â  };

Â  Â  Â  Â  let app, storage, db, auth;
Â  Â  Â  Â  let currentUser = null;

Â  Â  Â  Â  // Initialize Firebase on window load and set up authentication
Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes("YOUR_API_KEY")) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: API Key à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Firebase", "error");
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase Initialization Error: API Key is not valid.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  storage = getStorage(app);

Â  Â  Â  Â  Â  Â  // Listen for changes in the user's authentication state
Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, user => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Redirect to index5.html if the user is not authenticated
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸à¹ˆà¸­à¸™", "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = "index5.html";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = user;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("userNameDisplay").textContent = user.email || "à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸™à¸´à¸£à¸™à¸²à¸¡";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  const questions = [
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¸£à¸±à¸š à¹à¸•à¹ˆà¸•à¸­à¸™à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸ªà¸™à¹ƒà¸ˆà¸›à¸£à¸°à¸à¸±à¸™",
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¹€à¸§à¸¥à¸²à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š",
Â  Â  Â  Â  Â  Â  "à¸›à¸£à¸°à¸à¸±à¸™à¸¡à¸±à¸™à¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™à¹€à¸à¸´à¸™à¹„à¸›",
Â  Â  Â  Â  Â  Â  "à¸•à¸­à¸™à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™",
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¸„à¸¸à¸¢à¸à¸±à¸šà¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§à¸à¹ˆà¸­à¸™",
Â  Â  Â  Â  Â  Â  "à¸œà¸¡à¸¡à¸µà¸›à¸£à¸°à¸à¸±à¸™à¸­à¸¢à¸¹à¹ˆà¸«à¸¥à¸²à¸¢à¹€à¸¥à¹ˆà¸¡à¹à¸¥à¹‰à¸§",
Â  Â  Â  Â  Â  Â  "à¸à¸¥à¸±à¸§à¸§à¹ˆà¸²à¸œà¹ˆà¸­à¸™à¸ªà¹ˆà¸‡à¹„à¸¡à¹ˆà¹„à¸«à¸§",
Â  Â  Â  Â  Â  Â  "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸±à¹ˆà¸™à¹ƒà¸™à¸šà¸£à¸´à¸©à¸±à¸—",
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸§à¹ˆà¸²à¸™à¸µà¹‰",
Â  Â  Â  Â  Â  Â  "à¸•à¸­à¸™à¸™à¸µà¹‰à¸¡à¸µà¸ à¸²à¸£à¸°à¸«à¸™à¸µà¹‰à¸ªà¸´à¸™à¸­à¸¢à¸¹à¹ˆ",
Â  Â  Â  Â  Â  Â  "à¸œà¸¡à¸à¸³à¸¥à¸±à¸‡à¸¨à¸¶à¸à¸©à¸²à¸­à¸¢à¸¹à¹ˆà¸«à¸¥à¸²à¸¢à¸—à¸µà¹ˆ",
Â  Â  Â  Â  Â  Â  "à¸œà¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸à¹ˆà¸­à¸™",
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¹€à¸§à¸¥à¸²à¸„à¸´à¸”à¸—à¸šà¸—à¸§à¸™à¸­à¸µà¸à¸«à¸™à¹ˆà¸­à¸¢",
Â  Â  Â  Â  Â  Â  "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸²à¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸•à¸±à¸§à¹€à¸­à¸‡",
Â  Â  Â  Â  Â  Â  "à¸œà¸¡à¸¡à¸µà¸à¸²à¸•à¸´à¸—à¸³à¸›à¸£à¸°à¸à¸±à¸™à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§",
Â  Â  Â  Â  Â  Â  "à¸à¸¥à¸±à¸§à¸§à¹ˆà¸²à¸ªà¸±à¸à¸à¸²à¸ˆà¸°à¹„à¸¡à¹ˆà¸„à¸¸à¹‰à¸¡à¸„à¹ˆà¸²",
Â  Â  Â  Â  Â  Â  "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¹€à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸¡à¸²à¸à¸à¸­",
Â  Â  Â  Â  Â  Â  "à¸­à¸¢à¸²à¸à¹„à¸”à¹‰à¹à¸šà¸šà¸—à¸µà¹ˆà¸–à¸¹à¸à¸à¸§à¹ˆà¸²à¸™à¸µà¹‰",
Â  Â  Â  Â  Â  Â  "à¸‚à¸­à¹ƒà¸«à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­à¸à¸¥à¸±à¸šà¸¡à¸²à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¸«à¸¥à¸±à¸‡",
Â  Â  Â  Â  Â  Â  "à¸•à¸­à¸™à¸™à¸µà¹‰à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸­à¸¢à¸²à¸à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ"
Â  Â  Â  Â  ];

Â  Â  Â  Â  const container = document.getElementById("questions");
Â  Â  Â  Â  let audioChunks = {}; // Object to hold audio data for each question
Â  Â  Â  Â  let mediaRecorder;

Â  Â  Â  Â  // Create question elements dynamically
Â  Â  Â  Â  questions.forEach((q, i) => {
Â  Â  Â  Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  Â  Â  Â  div.className = "question";
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <p><b>${i+1}. ${q}</b></p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="start-btn" data-index="${i}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-microphone"></i> à¹€à¸£à¸´à¹ˆà¸¡à¸­à¸±à¸”à¹€à¸ªà¸µà¸¢à¸‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="stop-btn" data-index="${i}" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-stop-circle"></i> à¸«à¸¢à¸¸à¸”à¸­à¸±à¸”à¹€à¸ªà¸µà¸¢à¸‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="play-btn" data-index="${i}" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-play-circle"></i> à¸Ÿà¸±à¸‡à¹€à¸ªà¸µà¸¢à¸‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <audio id="audio${i}" controls style="display:none;"></audio>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="file-size" id="fileSize${i}"></span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  });

Â  Â  Â  Â  // Event listeners for buttons
Â  Â  Â  Â  document.addEventListener('click', e => {
Â  Â  Â  Â  Â  Â  const target = e.target.closest('button');
Â  Â  Â  Â  Â  Â  if (!target) return;
Â  Â  Â  Â  Â  Â  const index = target.getAttribute('data-index');

Â  Â  Â  Â  Â  Â  if (target.classList.contains('start-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  startRecording(index);
Â  Â  Â  Â  Â  Â  } else if (target.classList.contains('stop-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  stopRecording(index);
Â  Â  Â  Â  Â  Â  } else if (target.classList.contains('play-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  playRecording(index);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Start recording function using MediaRecorder API
Â  Â  Â  Â  async function startRecording(index) {
Â  Â  Â  Â  Â  Â  if (!navigator.mediaDevices) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¸­à¸±à¸”à¹€à¸ªà¸µà¸¢à¸‡", "error");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
Â  Â  Â  Â  Â  Â  Â  Â  // à¹ƒà¸Šà¹‰à¸„à¹ˆà¸² audioBitsPerSecond à¸—à¸µà¹ˆà¸•à¹ˆà¸³à¸¥à¸‡à¹€à¸à¸·à¹ˆà¸­à¸¥à¸”à¸‚à¸™à¸²à¸”à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¹ƒà¸«à¹‰à¸™à¹‰à¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”
Â  Â  Â  Â  Â  Â  Â  Â  const options = { mimeType: 'audio/mp4', audioBitsPerSecond: 16000 };
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder = new MediaRecorder(stream, options);

Â  Â  Â  Â  Â  Â  Â  Â  audioChunks[index] = [];
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.ondataavailable = e => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.data.size > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioChunks[index].push(e.data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.onstop = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob(audioChunks[index], { type: 'audio/mp4' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const audioEl = document.getElementById("audio" + index);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioEl.src = url;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioEl.style.display = "block";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`.play-btn[data-index="${index}"]`).disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Display file size
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileSizeKB = (blob.size / 1024).toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`fileSize${index}`).textContent = `à¸‚à¸™à¸²à¸”à¹„à¸Ÿà¸¥à¹Œ: ${fileSizeKB} KB`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§", "info");
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.start();
Â  Â  Â  Â  Â  Â  Â  Â  // Update button states
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`.start-btn[data-index="${index}"]`).disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`.stop-btn[data-index="${index}"]`).disabled = true;
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Media recording error:", err);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸¡à¹‚à¸„à¸£à¹‚à¸Ÿà¸™à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸´à¸—à¸˜à¸´à¹Œ", "error");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Stop recording function
Â  Â  Â  Â  function stopRecording(index) {
Â  Â  Â  Â  Â  Â  if (mediaRecorder && mediaRecorder.state !== "inactive") {
Â  Â  Â  Â  Â  Â  Â  Â  mediaRecorder.stop();
Â  Â  Â  Â  Â  Â  Â  Â  // Update button states
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`.start-btn[data-index="${index}"]`).disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector(`.stop-btn[data-index="${index}"]`).disabled = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Play recorded audio
Â  Â  Â  Â  function playRecording(index) {
Â  Â  Â  Â  Â  Â  const audioEl = document.getElementById("audio" + index);
Â  Â  Â  Â  Â  Â  if (audioEl.src) {
Â  Â  Â  Â  Â  Â  Â  Â  audioEl.play();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¹ƒà¸«à¹‰à¹€à¸¥à¹ˆà¸™", "error");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Upload all recorded files with a progress indicator
Â  Â  Â  Â  async function uploadAll() {
Â  Â  Â  Â  Â  Â  if (!currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  return showMessage("à¹„à¸¡à¹ˆà¸à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¹ƒà¸«à¸¡à¹ˆ", "error");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Check if all questions have been recorded
Â  Â  Â  Â  Â  Â  const allRecorded = questions.every((_, i) => audioChunks[i] && audioChunks[i].length > 0);
Â  Â  Â  Â  Â  Â  if (!allRecorded) {
Â  Â  Â  Â  Â  Â  Â  Â  return showMessage("à¸à¸£à¸¸à¸“à¸²à¸­à¸±à¸”à¹€à¸ªà¸µà¸¢à¸‡à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¸‚à¹‰à¸­à¸à¹ˆà¸­à¸™", "error");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const loadingOverlay = document.getElementById("loadingOverlay");
Â  Â  Â  Â  Â  Â  const loadingText = document.getElementById("loadingText");
Â  Â  Â  Â  Â  Â  const progressBar = document.getElementById("progressBar");
Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = "flex";

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const uploadPromises = questions.map((_, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob(audioChunks[i], { type: 'audio/mp4' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileName = `${currentUser.uid}_answer${i+1}.mp4`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const storageRef = ref(storage, `audios/${currentUser.uid}/${fileName}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const uploadTask = uploadBytesResumable(storageRef, blob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // We can add a listener for each upload to get progress
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uploadTask.on('state_changed', (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // This shows individual file progress, which can be confusing.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // It's better to calculate overall progress as shown below.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return uploadTask;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Wait for all uploads to complete
Â  Â  Â  Â  Â  Â  Â  Â  const snapshots = await Promise.all(uploadPromises);

Â  Â  Â  Â  Â  Â  Â  Â  // Get all download URLs and save to Firestore
Â  Â  Â  Â  Â  Â  Â  Â  const firestorePromises = snapshots.map(async (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = await getDownloadURL(snapshot.ref);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const questionIndex = parseInt(snapshot.ref.name.match(/answer(\d+)/)[1]) - 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return addDoc(collection(db, 'submissions'), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: currentUser.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: currentUser.email || 'anonymous',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question: questionIndex + 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioUrl: url,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Wait for all Firestore writes to complete
Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(firestorePromises);

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§!", "info");
Â  Â  Â  Â  Â  Â  Â  Â  // Redirect to index5.html after successful upload
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = "index5.html";
Â  Â  Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”', err);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡", "error");
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = "none";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('submitAllBtn').addEventListener('click', uploadAll);
Â  Â  </script>
</body>
</html>




